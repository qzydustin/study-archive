/*
 * regalloc-12: register allocation and function calls
 *
 * This program tests correctness of register allocation in dealing with 
 * function calls that have side effects on globals.
 */

extern void println(int x);

int counter;

int g(int n) {
    int i, j, k, x;
    
    counter = counter + 1;    /* <<< SIDE EFFECT */

    x = n;
    for (i = 0; i < 10; i = i+1) {
        for (j = 0; j < 10; j = j+1) {
            for (k = 0; k < 10; k = k+1) {
	        x = x+1;
	    }
	}
    }

    return x;
}


void main(void) {
    int x;
    
    /* lots of references to counter: will it be put into a register? */
    counter = 0;
    counter = counter + 1; counter = counter + 1;
    counter = counter + 1; counter = counter + 1;
    counter = counter + 1; counter = counter + 1;

    x = g(1);    /* g() has a side effect on counter */
    
    counter = counter + 1; counter = counter + 1;
    counter = counter + 1; counter = counter + 1;
    counter = counter + 1; counter = counter + 1;

    println(x);
    println(counter);

}